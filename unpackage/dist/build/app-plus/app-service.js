if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then(a=>t.resolve(e()).then(()=>a),a=>t.resolve(e()).then(()=>{throw a}))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";const t=(e,t)=>{const a=e.__vccOpts||e;for(const[o,n]of t)a[o]=n;return a};const a=t({methods:{goToQueue(){uni.navigateTo({url:"/pages/index/queue"})},goToTest(){uni.navigateTo({url:"/pages/index/test"})},goToImage(){uni.$store.dispatch("setSelfieImgBase64","data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAUEAEAAAAAAAAAAAAAAAAAAAAA/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAX/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwCdABmX/9k="),uni.navigateTo({url:"/pages/index/image"})}}},[["render",function(t,a,o,n,i,l){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("button",{class:"nav-button",onClick:a[0]||(a[0]=(...e)=>l.goToQueue&&l.goToQueue(...e))},"进入队列页面"),e.createElementVNode("button",{class:"nav-button",onClick:a[1]||(a[1]=(...e)=>l.goToTest&&l.goToTest(...e))},"进入测试页面")])}]]);function o(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}const n=t({__name:"image",setup(t){const a=e.ref(""),n=e.ref(0),i=e.ref(0),l=e.ref(!0),s=e.ref(!1);e.onMounted(()=>{const e=uni.getSystemInfoSync();n.value=e.windowWidth,i.value=e.windowHeight-uni.upx2px(594),o("log","at pages/index/image.vue:51","图片显示页面加载"),o("log","at pages/index/image.vue:52","Store状态:",uni.$store.state);const t=uni.$store.state.selfieImgBase64;o("log","at pages/index/image.vue:56","获取到的图片数据长度:",t?t.length:0),t&&t.length>0?(a.value=t,o("log","at pages/index/image.vue:60","设置图片源成功")):(s.value=!0,o("error","at pages/index/image.vue:63","未找到图片数据"),uni.showToast({title:"未找到图片数据",icon:"error"}),setTimeout(()=>{uni.navigateBack()},1500))});const r=e=>{o("log","at pages/index/image.vue:76","图片加载成功",e),l.value=!1,s.value=!1},u=e=>{o("log","at pages/index/image.vue:83","图片加载失败",e),l.value=!1,s.value=!0,uni.showToast({title:"图片加载失败",icon:"error"})},c=()=>{uni.navigateBack()},A=()=>{uni.navigateBack()},d=()=>{uni.showToast({title:"图片已确认",icon:"success"})};return(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"image-display-container"},[e.createElementVNode("view",{class:"back-button",onClick:c},[e.createElementVNode("text",{class:"back-text"},"返回")]),e.createElementVNode("view",{class:"image-container"},[e.createElementVNode("image",{src:a.value,class:"display-image",mode:"aspectFill",style:e.normalizeStyle({width:`${n.value}px`,height:`${i.value}px`}),onLoad:r,onError:u},null,44,["src"])]),e.createElementVNode("view",{class:"action-buttons"},[e.createElementVNode("view",{class:"action-button",onClick:A},[e.createElementVNode("text",{class:"button-text"},"重新拍照")]),e.createElementVNode("view",{class:"action-button primary",onClick:d},[e.createElementVNode("text",{class:"button-text"},"确认使用")])])]))}},[["__scopeId","data-v-30914cdd"]]),i=uni.requireUTSPlugin("uni_modules/bsf-ali-queen"),l=t({__name:"ablum",setup(t){const a=e.ref(""),n=e.ref(""),l=e.ref(!1),s=[{id:1,value:.6},{id:2,value:.5},{id:3,value:.4},{id:4,value:.7},{id:5,value:.6},{id:7,value:.5},{id:9,value:.3},{id:8,value:.4},{id:13,value:.5},{id:14,value:.3},{id:15,value:.6},{id:16,value:.5}],r=()=>{uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["album"],success:e=>{const t=e.tempFilePaths[0];a.value=t,n.value="",o("log","at pages/index/ablum.vue:113","选择的图片路径:",t),uni.showToast({title:"图片选择成功，开始美颜处理...",icon:"success",duration:1500}),setTimeout(()=>{u()},500)},fail:e=>{o("error","at pages/index/ablum.vue:128","选择图片失败:",e),uni.showToast({title:"选择图片失败",icon:"error"})}})},u=async()=>{if(a.value){l.value=!0;try{s.forEach(e=>{i.setBeautyParam(e.id,e.value)});let e=a.value;e.startsWith("file://")&&(e=e.replace(/^file:\/+/,"")),i.beautifyImage({path:e,success:e=>{o("log","at pages/index/ablum.vue:167","美颜处理成功:",e);let t="";if("string"==typeof e)t=e;else if(e.base64)t=e.base64;else{if(!e.data)return o("error","at pages/index/ablum.vue:177","未知的返回数据格式:",e),uni.showToast({title:"美颜处理返回数据格式错误",icon:"error"}),void(l.value=!1);t=e.data}t.startsWith("data:")||(t=`data:image/jpeg;base64,${t}`),n.value=t,l.value=!1,uni.showToast({title:"美颜处理完成",icon:"success"})},fail:e=>{o("error","at pages/index/ablum.vue:200","美颜处理失败:",e),l.value=!1,uni.showToast({title:"美颜处理失败",icon:"error"})}})}catch(e){o("error","at pages/index/ablum.vue:210","美颜处理异常:",e),l.value=!1,uni.showToast({title:"美颜处理异常",icon:"error"})}}else uni.showToast({title:"请先选择图片",icon:"none"})},c=()=>{if(!n.value)return void uni.showToast({title:"没有可保存的图片",icon:"none"});const e=n.value.startsWith("data:")?n.value:`data:image/jpeg;base64,${n.value}`,t=uni.createCanvasContext("beautyCanvas");t.drawImage(e,0,0,300,300),t.draw(!1,()=>{setTimeout(()=>{uni.canvasToTempFilePath({canvasId:"beautyCanvas",success:e=>{uni.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:()=>{uni.showToast({title:"图片已保存到相册",icon:"success"})},fail:e=>{o("error","at pages/index/ablum.vue:252","保存图片失败:",e),uni.showToast({title:"保存图片失败",icon:"error"})}})},fail:e=>{o("error","at pages/index/ablum.vue:261","转换图片失败:",e),uni.showToast({title:"转换图片失败",icon:"error"})}})},100)})},A=()=>{a.value="",n.value="",l.value=!1,uni.showToast({title:"已重置",icon:"success"})},d=()=>{uni.navigateBack({delta:1})};return e.onMounted(()=>{(()=>{try{i.initEngine({licenseKey:"vPbqtgx4UHuy4gJobc5640b9145fe4770820af1eac919c258",licenseFile:"AliVideoCert-com_byteee_uniappdemo-20250630094102.crt"}),i.enableBeautyType(0,!0,0),i.enableBeautyType(1,!0,0),i.enableBeautyType(2,!0,0),i.enableBeautyType(4,!0,0),o("log","at pages/index/ablum.vue:93","美颜引擎初始化成功")}catch(e){o("error","at pages/index/ablum.vue:95","美颜引擎初始化失败:",e),uni.showToast({title:"美颜引擎初始化失败",icon:"error"})}})()}),e.onUnmounted(()=>{o("log","at pages/index/ablum.vue:298","onUnload");try{i.destroyEngine(),o("log","at pages/index/ablum.vue:301","美颜引擎已销毁")}catch(e){o("error","at pages/index/ablum.vue:303","销毁美颜引擎失败:",e)}}),(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"album-container"},[e.createElementVNode("view",{class:"nav-bar"},[e.createElementVNode("view",{class:"back-btn",onClick:d},[e.createElementVNode("text",{class:"back-icon"},"‹")]),e.createElementVNode("text",{class:"nav-title"},"相册美颜"),e.createElementVNode("view",{class:"placeholder"})]),e.createElementVNode("view",{class:"main-content"},[a.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"image-preview"},[e.createElementVNode("image",{src:n.value||a.value,class:"preview-image",mode:"aspectFit"},null,8,["src"]),l.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"image-overlay"},[e.createElementVNode("view",{class:"loading-spinner"}),e.createElementVNode("text",{class:"loading-text"},"美颜处理中...")])):e.createCommentVNode("",!0),n.value&&!l.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"beauty-complete"},[e.createElementVNode("text",{class:"complete-text"},"美颜完成")])):e.createCommentVNode("",!0)])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"default-hint"},[e.createElementVNode("image",{src:"/static/imgs/photoLibrary/p1.png",class:"hint-icon"}),e.createElementVNode("text",{class:"hint-text"},"请选择一张图片进行美颜")])),e.createElementVNode("view",{class:"action-buttons"},[e.createElementVNode("button",{class:"select-btn",onClick:r,disabled:l.value},[e.createElementVNode("text",{class:"btn-text"},e.toDisplayString(l.value?"处理中...":"选择图片"),1)],8,["disabled"]),e.createElementVNode("button",{class:"save-btn",onClick:c,disabled:!n.value||l.value},[e.createElementVNode("text",{class:"btn-text"},"保存图片")],8,["disabled"]),e.createElementVNode("button",{class:"reset-btn",onClick:A,disabled:l.value},[e.createElementVNode("text",{class:"btn-text"},"重置")],8,["disabled"])])]),e.createElementVNode("canvas",{"canvas-id":"beautyCanvas",style:{position:"absolute",left:"-9999px",width:"300px",height:"300px"}})]))}},[["__scopeId","data-v-660cc8b6"]]);__definePage("pages/index/index",a),__definePage("pages/index/image",n),__definePage("pages/index/ablum",l);const s={onLaunch:function(){o("log","at App.vue:4","App Launch")},onShow:function(){o("log","at App.vue:7","App Show")},onHide:function(){o("log","at App.vue:10","App Hide")}},r=e.reactive({selfieImgBase64:"",isJudge:!1,loadComplete:!1,selfieImgTemp:""}),u={setSelfieImgBase64(e){r.selfieImgBase64=e},setIsJudge(e){r.isJudge=e},setLoadComplete(e){r.loadComplete=e},setSelfieImgTemp(e){r.selfieImgTemp=e}},c={state:r,dispatch(e,t){u[e]&&u[e](t)}};const{app:A,Vuex:d,Pinia:g}=function(){const t=e.createVueApp(s);return t.config.globalProperties.$store=c,uni.$store=c,{app:t}}();uni.Vuex=d,uni.Pinia=g,A.provide("__globalStyles",__uniConfig.styles),A._component.mpType="app",A._component.render=()=>{},A.mount("#app")}(Vue);
